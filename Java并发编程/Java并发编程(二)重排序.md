# **Java并发编程(二)-重排序**

当我们写一个单线程程序时，总以为计算机会一行行地运行代码，然而事实并非如此。

## 什么是重排序？

重排序指的是编译器、处理器在不改变程序执行结果的前提下，重新排列指令的执行顺序，以达到最佳的运行效率。



## 重排序分类

重排序分为：编译器重排序 和 处理器重排序。



## 数据依赖

编译器和处理器并不会随意的改变指令的执行顺序，因为有些指令之间是有依赖关系的，若改变了他们的执行顺序，就会出现错误的结果。 
因此，编译器和处理器只会对没有依赖关系的指令进行重排序。

数据依赖：若相邻的两条指令访问同一个变量，并且其中有一条指令执行写操作，那么这样的两条指令之间存在数据依赖。对于有数据依赖关系的指令，不会发生重排序。

数据依赖关系总结一下为以下三种情况：

|  指令  |   示例   |
| :----: | :------: |
| 读后写 | a=b;b=1; |
| 写后写 | a=b;b=1; |
| 写后读 | a=1;b=a; |

### as-if-serial

在单线程开发中，程序员不需要知道指令是如何重排序的，只要简单地认为指令是按照顺序依次执行的即可。这就是as-if-serial的语义，即：貌似是串行的。



